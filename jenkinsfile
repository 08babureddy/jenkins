pipeline {
    agent any
    stages {
        stage('Test') {
            steps {
                script {
                    // Running multiple commands in a shell step
                    sh '''
                    cd ${WORKSPACE}
                    source venv/bin/activate
                    python -m behave --tags ${Tagname}
                    '''
                }
            }
        }
    }
    post {
        always {
            // Defining variables for the email content
            def pipeline_name = env.JOB_NAME
            def build_number = currentBuild.number
            def buildStatus = currentBuild.result ?: 'UNKNOWN' // Handling null or empty status

            // Sending the email with the build status
            emailext(
                subject: "${pipeline_name} - Build #${build_number} - ${buildStatus}",
                body: """
                    <h3>Test Results for Build ${build_number}</h3>
                    <p>Status: ${buildStatus}</p>
                    <p>Click <a href="">here</a> to view the HTML report.</p>
                """,
                to: 'chinnareddy.b@datapoem.com',
                mimeType: 'text/html'
            )
        }
    }
}
